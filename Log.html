<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Relatรณrio de Presenรงa - ADMIN</title>
	<link rel="icon" type="image/x-icon" href="favicon.ico">
ย ย <style>
ย ย ย ย body {
ย ย ย ย ย ย font-family: sans-serif;
ย ย ย ย ย ย background-color: #f4f4f9;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }
ย ย ย ย .container {
ย ย ย ย ย ย max-width: 1000px;
ย ย ย ย ย ย margin: 20px auto;
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            /* ESCONDE O CONTEรDO ATร QUE A SENHA SEJA DIGITADA */
            display: none; 
ย ย ย ย }
ย ย ย ย h1 {
ย ย ย ย ย ย color: #0077B5;
ย ย ย ย }
ย ย ย ย table {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย border-collapse: collapse;
ย ย ย ย ย ย margin-top: 20px;
ย ย ย ย }
ย ย ย ย th, td {
ย ย ย ย ย ย border: 1px solid #ddd;
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย text-align: left;
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย }
ย ย ย ย th {
ย ย ย ย ย ย background-color: #0077B5;
ย ย ย ย ย ย color: white;
ย ย ย ย }
ย ย ย ย tr:nth-child(even) {
ย ย ย ย ย ย background-color: #f2f2f2;
ย ย ย ย }
ย ย ย ย #loading {
ย ย ย ย ย ย font-size: 18px;
ย ย ย ย ย ย color: #555;
ย ย ย ย ย ย margin-top: 30px;
ย ย ย ย }
ย ย </style>
</head>
<body>

ย ย <div class="container">
ย ย ย ย <h1>Relatรณrio de Presenรงa Diรกria</h1>
ย ย ย ย <p>Dados brutos de todos os registros de presenรงa feitos via API. **(Acesso Admin)**</p>
ย ย ย ยย
ย ย ย ย <div id="loading">Carregando dados da planilha...</div>

ย ย ย ย <table id="presencaTable" style="display: none;">
ย ย ย ย ย ย <thead>
ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย <th>Nome do Aluno</th>
ย ย ย ย ย ย ย ย ย ย <th>CPF do Aluno</th>
                    <th>Data do Registro</th>
ย ย ย ย ย ย ย ย ย ย <th>Hora do Registro</th>
ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย </thead>
ย ย ย ย ย ย <tbody id="presencaData">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย </table>

ย ย ย ย <p id="error" style="color: red; margin-top: 20px;"></p>
ย ย </div>

ย ย <script>
ย ย ย ย // ๐จ SEU URL CORRETO: (Mantenha o URL de Apps Script usado nas etapas anteriores)
ย ย ย ย const SHEETDB_API_URL = 'https://script.google.com/macros/s/AKfycbyZkAwC19qf7Lu5vT3lhS7QN03KJcr4weoU6NYLbbzcD17bbLiAh3C51vXoPvISeR40/exec';
        // Aรงรฃo para buscar o log
        const ADMIN_API_URL = `${SHEETDB_API_URL}?action=get_log_presenca`;

        // ๐จ SEGURANรA: DEFINA UMA SENHA SECRETA AQUI!
        const ADMIN_PASSWORD = 'AutoEscola2025'; 

        /**
         * Checa o acesso do administrador com um prompt simples.
         */
        function checkAdminAccess() {
            const container = document.querySelector('.container');
            // Remove a mensagem de carregamento inicial
            document.getElementById('loading').style.display = 'none';

            const password = prompt("๐ Por favor, digite a senha de administrador para acessar o relatรณrio:");

            if (password === ADMIN_PASSWORD) {
                container.style.display = 'block'; // Mostra o container
                fetchPresencaData();
            } else {
                container.style.display = 'block';
                container.innerHTML = '<h1>โ Acesso Negado</h1><p>Vocรช nรฃo tem permissรฃo para visualizar este relatรณrio.</p>';
            }
        }
ย ย ย ย 
ย ย ย ย /**
ย ย ย ย ย* Busca todos os dados da planilha de presenรงa e exibe-os em uma tabela.
ย ย ย ย ย*/
ย ย ย ย async function fetchPresencaData() {
ย ย ย ย ย ย const loading = document.getElementById('loading');
ย ย ย ย ย ย const table = document.getElementById('presencaTable');
ย ย ย ย ย ย const tbody = document.getElementById('presencaData');
ย ย ย ย ย ย const errorElement = document.getElementById('error');
ย ย ย ย ย ยย
ย ย ย ย ย ย loading.style.display = 'block';
ย ย ย ย ย ย table.style.display = 'none';
ย ย ย ย ย ย errorElement.textContent = '';
ย ย ย ย ย ย tbody.innerHTML = ''; // Limpa dados anteriores
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // 1. Faz uma requisiรงรฃo GET para buscar TODOS os dados do log
ย ย ย ย ย ย ย ย const response = await fetch(ADMIN_API_URL);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (!response.ok) {
ย ย ย ย ย ย ย ย ย ย throw new Error(`Falha na API: Status ${response.status}`);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (!data || data.length === 0) {
ย ย ย ย ย ย ย ย ย ย errorElement.textContent = 'Nenhum registro de presenรงa encontrado na planilha.';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // 2. Itera sobre os dados e preenche a tabela
ย ย ย ย ย ย ย ย data.forEach(record => {
ย ย ย ย ย ย ย ย ย ย const row = tbody.insertRow();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // As chaves de objeto ('nome_aluno', 'cpf', etc.) vรชm do Apps Script
ย ย ย ย ย ย ย ย ย ย row.insertCell().textContent = record.nome_aluno || 'N/A';
ย ย ย ย ย ย ย ย ย ย row.insertCell().textContent = record.cpf || 'N/A';
                    row.insertCell().textContent = record.data_registro || 'N/A';
ย ย ย ย ย ย ย ย ย ย row.insertCell().textContent = record.hora_registro || 'N/A';
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย // 3. Exibe a tabela
ย ย ย ย ย ย ย ย table.style.display = 'table';

ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error("Erro ao carregar relatรณrio:", error);
ย ย ย ย ย ย ย ย errorElement.textContent = `Erro ao carregar relatรณrio. Verifique a URL da API e a conexรฃo. Detalhes: ${error.message}`;
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย loading.style.display = 'none';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // Inicia o cheque de acesso ao carregar a pรกgina
ย ย ย ย window.onload = checkAdminAccess;

ย ย </script>
</body>
</html>